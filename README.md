# competition-of-the-Pharmacy-trolley
my competition recording 
# EPRobot智能小车 - 智慧药房解决方案

## 项目概述
本项目是大连海事大学远航队为第二十六届中国机器人及人工智能大赛机器人任务挑战赛（智慧药房）设计的EPRobot智能小车系统，旨在实现智慧药房场景下的自动化取药、配药、药品识别及答题等任务。


## 目录
- [项目概述](#项目概述)
- [技术路线](#技术路线)
- [创新点及测试效果](#创新点及测试效果)
- [核心问题与解决方案](#核心问题与解决方案)
- [技术方案](#技术方案)
- [方案实现](#方案实现)
- [测试分析](#测试分析)
- [作品总结](#作品总结)
- [参考文献](#参考文献)


## 技术路线
EPRobot智能小车以**树莓派4B**为核心计算平台，搭载**ROS-melodic**机器人开发框架，构建了从底层控制到高层决策的全链条系统，具体技术架构如下：

1. **硬件架构**：
   - 核心控制器：树莓派4B（四核Cortex-A72 CPU，4GB内存）
   - 传感器：激光雷达（环境感知）、深度相机（三维视觉）、IMU（姿态监测）
   - 执行器：STM32控制器（实时调整运动状态）、阿克曼底盘（后轮驱动+前轮转向）
   - 通信：Wi-Fi/蓝牙（无线通信）、以太网（有线通信）

2. **软件架构**：
   - 操作系统：Ubuntu 18.04（运行于树莓派）
   - 开发框架：ROS-melodic（节点化通信与任务调度）
   - 控制流程：树莓派处理传感器数据→计算运动指令→发送至STM32→执行运动控制
   - 远程交互：通过PC端（Windows/Linux）远程启动ROS功能包


## 创新点及测试效果
1. **多传感器融合技术**  
   融合激光雷达、深度相机和IMU数据，提升环境感知的鲁棒性，测试中对复杂环境的感知准确率提升30%+。

2. **SLAM与3D建图**  
   基于激光雷达和深度相机实现同步定位与地图构建（SLAM），支持二维/三维地图生成，测试中在复杂场景下地图精度达±5cm。

3. **自主导航与动态避障**  
   采用TEB算法（适配阿克曼底盘）和AMCL定位算法，实现动态路径规划与避障，测试中动态环境导航成功率达90%+。

4. **物体识别与追踪**  
   通过图像处理技术实现药品、障碍物等目标的识别与追踪，测试中识别准确率达85%+。

5. **语音交互**  
   集成语音识别与合成模块，支持语音指令与播报，测试中语音指令响应速度<1s。


## 核心问题与解决方案
### 1. 地图构建
- **挑战**：动态环境干扰、传感器噪声、多尺度地图表示
- **解决方案**：
  - 采用卡尔曼滤波和非线性观测器处理传感器噪声
  - 基于事件触发的地图更新机制适配动态环境
  - 实现多尺度地图表示，支持不同导航精度需求


### 2. 定位
- **挑战**：初始位置不确定性、环境特征缺失、计算资源限制
- **解决方案**：
  - 基于AMCL（自适应蒙特卡洛定位）算法，通过粒子滤波估计位姿
  - 融合激光雷达与深度相机数据补充环境特征
  - 优化粒子数量，平衡定位精度与计算效率


### 3. 路径规划
- **挑战**：动态避障、多机器人协同、实时性要求
- **解决方案**：
  - 采用TEB算法实现局部路径规划，支持动态避障
  - 分布式协同规划方法解决多机器人冲突
  - 算法并行化优化，确保路径规划响应时间<500ms


## 技术方案
### 硬件设计
| 组件 | 规格与功能 |
|------|------------|
| 主控制器 | 树莓派4B（四核Cortex-A72，4GB内存，Ubuntu 18.04系统） |
| 运动控制 | STM32控制器（PID+MFAC算法，控制电机与转向舵机） |
| 传感器 | 激光雷达（360°扫描，测距精度±2cm）、深度相机（三维视觉）、IMU（姿态监测） |
| 底盘 | 阿克曼结构（后轮驱动，前轮转向，适配真实车辆运动学模型） |
| 通信 | Wi-Fi/蓝牙（无线控制）、以太网（数据传输） |
| 电源 | 12V电池输入，支持5V/12V外设供电 |


### 软件设计
- **核心框架**：ROS-melodic，采用节点化设计，支持模块化开发
- **节点通信**：通过ROS话题（Topic）实现异步数据传输，服务（Service）实现同步指令交互
- **开发环境**：树莓派4B（Ubuntu 18.04）+ 远程PC（Windows/Linux，用于启动ROS功能包与监控）


## 方案实现
### 1. 取药环节
- **流程**：
  1. 接收中央控制系统的药品分发任务
  2. 基于深度相机与图像识别定位药品位置
  3. 规划最优路径导航至药柜，完成取药
- **关键技术**：OpenCV图像预处理、激光雷达环境建模、TEB路径规划


### 2. 配药环节
- **核心任务**：识别配药区字母标识，匹配取药区位置并播报
- **技术细节**：
  - 透视变换：校正识别板倾斜角度，提升识别精度
  - 轮廓提取：通过高斯模糊+Canny边缘检测，提取字母框轮廓
  - 模板匹配：双重缩放（待识别图像+模板）提升匹配鲁棒性，识别准确率达90%+


### 3. 答题环节
- **核心任务**：识别药品类别（圆形药丸、双色胶囊、鱼肝油等）
- **技术细节**：
  - 模型选择：ShuffleNetV2轻量级网络（对比MobileNet、GhostNet，推理速度提升20%）
  - 迁移学习：基于预训练模型微调，冻结底层参数，仅训练分类头
  - 部署优化：采用NCNN框架，适配树莓派ARM架构，推理时间<1s
- **数据集**：5类药品（鱼肝油、椭圆药丸、圆形药丸、单色胶囊、双色胶囊），训练集1201张，验证集343张


### 4. 图像识别
- 基于PyTorch框架训练目标识别模型，支持车道线检测、障碍物识别等
- 数据增强：随机裁剪、旋转、水平翻转，提升模型泛化能力
- 可视化工具：通过准确率曲线、损失曲线、分类热力图评估模型性能


## 测试分析
### 硬件性能测试
| 任务 | 耗时 | 稳定性 |
|------|------|--------|
| 起点→识别板1 | 1.5s | 连续10次测试无故障 |
| 90度转弯 | 1s | 转弯误差<3° |
| 配药区→取药区 | 30s | 定位精度±5cm |


### 软件稳定性测试
| 测试轮次 | 配药区识别 | 取药区导航 | 药品识别 |
|----------|------------|------------|----------|
| 1 | 准确 | 准确 | 准确 |
| 2 | 准确 | 准确 | 准确 |
| 3 | 准确 | 准确 | 错误 |
| 4 | 准确 | 准确 | 准确 |
| 5 | 准确 | 准确 | 错误 |
- 整体稳定性：功能正常率80%，主要误差源于药品识别（光线干扰导致）


### 功能实现准确性测试
- 地图构建精度：二维地图误差±5cm，三维地图细节还原率90%+
- 路径规划：最优路径选择准确率95%，动态避障成功率90%
- 药品识别：平均准确率88%（其中圆形药丸、双色胶囊识别率达95%）


## 作品总结
### 技术难点与解决策略
1. **多传感器融合冲突**：通过卡尔曼滤波统一数据坐标系，降低噪声影响
2. **动态环境导航**：采用事件触发的地图更新机制，实时调整路径
3. **嵌入式端推理效率**：通过模型轻量化（ShuffleNetV2）+NCNN框架部署，提升推理速度


### 项目展望
1. 优化药品识别模型，提升复杂光线环境下的准确率
2. 扩展多机器人协同调度功能，支持大规模药房场景
3. 增加药品库存监测功能，实现全流程自动化管理


### 结论
EPRobot智能小车通过多传感器融合、SLAM建图、自主导航、深度学习识别等技术，成功实现了智慧药房场景下的取药、配药、答题等任务，硬件稳定、软件可靠，具备实际应用价值。


## 参考文献
1. [ROS 官网](http://www.ros.org)
2. [树莓派官方文档](https://www.raspberrypi.org/documentation/)
3. [科大讯飞开发者平台](https://www.xfyun.cn)
4. [OpenCV 官方文档](https://opencv.org/android/)
5. [GMapping SLAM 算法](http://wiki.ros.org/gmapping)
6. [AMCL 算法详解](http://wiki.ros.org/amcl)
7. [Move Base 导航框架](http://wiki.ros.org/move_base)
8. [RTAB-Map 3D 建图算法](https://github.com/introlab/rtabmap)


## 附录
- 主要程序代码：包括调度代码、字母识别代码、药品识别代码、模型训练代码（详见项目仓库附录）
